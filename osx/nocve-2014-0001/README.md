# LPE issue in OS X 10.9

We identified integer signedness bug affecting service
IOBluetoothHCIController (implemented by the IOBluetoothFamily
KEXT). This vulnerability can be exploited by a local attacker to
gain root privileges. The issue is present on the latest versions
of OS X Mavericks (tested on 10.9.4 and 10.9.5), but has been
“silently” patched by Apple in OS X Yosemite (10.10).

In a nutshell, the bug lies in the
```c++
IOBluetoothHCIUserClient::SimpleDispatchWL()
```
function. This function takes a user-supplied 32-bit signed
integer value and uses it to index a global array of structures
containing a function pointer. The chosen function pointer is
finally called. SimpleDispatchWL() fails at properly sanitizing
the user-supplied index, allowing a local attacker to chose a
value such that the execution is redirected to code under his own
control.

We released a [quick and dirty poc](poc.c) for this vulnerability that will
redirect the execution to an _empty_ ```payload``` function. Please note it 
won't work on systems with SMEP enabled.

For further details, please refer to our full [blog
post](http://randomthoughts.greyhats.it/2014_10_01_archive.html).
