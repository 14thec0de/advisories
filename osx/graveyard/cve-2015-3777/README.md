# Multiple stack-based overflows in blued

* _Authors_: Roberto Paleari ([@rpaleari](https://twitter.com/rpaleari)) and Aristide Fattori ([@joystick](https://twitter.com/joystick))
* _Notification date_: 06/07/2015
* _Release date_: 29/09/2015
* _Status_: Fixed in OS X 10.10.5
* _Notes_: This vulerability was killed by mitp0sh with CVE-2015-3777

We identified two stack-based buffer overflow vulnerabilities affecting service `blued`. Both these vulnerabilities can be exploited by leveraging an XPC service exposed by `blued`.

Briefly, affected methods blindly copy a user-supplied XPC data buffer to a stack location via a `bcopy(src, dst, len)` call, where both `src` and `len` parameters are attacker-controlled. An attacker can thus invoke the affected methods providing a specially-crafted XPC object that permits to control a data or even a code pointer.

## Stack-based overflow in method 0x101a ##
[xpc_blued_overflow1.c](xpc_blued_overflow1.c)

This PoC triggers a stack-based buffer overflow in method with selector 0x101a (method #26). The PoC causes the process to crash due to a killed stack canary.

## Stack-based overflow in method 0x1019 ##
[xpc_blued_overflow2.c](xpc_blued_overflow2.c)

This PoC triggers a stack-based buffer overflow in method with selector 0x1019 (method #25). The vulnerable code fragment is a little bit more convoluted than the previous one, as the method performs two consecutive calls to `bcopy(src, dst, len)`, both with `src` and `len` fully controlled by the attacker. Service `blued` here crashes due to an invalid memory access.
